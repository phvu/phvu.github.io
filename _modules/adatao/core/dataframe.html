<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>adatao.core.dataframe &mdash; PyClient 0.3.0 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="PyClient 0.3.0 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">PyClient 0.3.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for adatao.core.dataframe</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Jan 3, 2014</span>

<span class="sd">@author: nhanvlc</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">util</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">filter_expression_parser</span> <span class="kn">import</span> <span class="n">FilterExpressionVisitor</span>


<div class="viewcode-block" id="create_distributed_data_frame"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.create_distributed_data_frame">[docs]</a><span class="k">def</span> <span class="nf">create_distributed_data_frame</span><span class="p">(</span><span class="n">cli</span><span class="p">,</span> <span class="n">res</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Utility function to create a DistributedDataFrame from the server response.</span>
<span class="sd">    This is not intended to be used by the user.</span>
<span class="sd">    :param cli: Client object</span>
<span class="sd">    :param res: a json object containing information about the DDF</span>
<span class="sd">    :return: a DistributedDataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">decode_header</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">entry</span><span class="p">:</span> <span class="n">entry</span><span class="p">[</span><span class="s">&#39;header&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">,</span> <span class="s">&#39;ignore&#39;</span><span class="p">)</span>

        <span class="n">col_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">decode_header</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;metaInfo&#39;</span><span class="p">]]</span>
        <span class="n">col_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;metaInfo&#39;</span><span class="p">]]</span>
        <span class="n">col_categories</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;DistributedFactor&#39;</span> <span class="k">if</span> <span class="s">&#39;factor&#39;</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">else</span> <span class="n">util</span><span class="o">.</span><span class="n">to_category</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">])</span>
                          <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;metaInfo&#39;</span><span class="p">]]</span>
        <span class="n">col_factors</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">decode_header</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">[</span><span class="s">&#39;factor&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;metaInfo&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s">&#39;factor&#39;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">])</span>

        <span class="n">is_mutable</span> <span class="o">=</span> <span class="bp">False</span> <span class="k">if</span> <span class="s">&#39;isMutable&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">else</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;isMutable&#39;</span><span class="p">]</span>

        <span class="n">safe_get</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">dic</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">default_val</span><span class="p">:</span> <span class="n">default_val</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dic</span> <span class="k">else</span> <span class="n">dic</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">DistributedDataFrame</span><span class="p">(</span><span class="n">cli</span><span class="p">,</span>
                                    <span class="n">oid</span><span class="o">=</span><span class="n">res</span><span class="p">[</span><span class="s">&#39;uuid&#39;</span><span class="p">],</span>
                                    <span class="n">name</span><span class="o">=</span><span class="n">safe_get</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span>
                                    <span class="n">owner</span><span class="o">=</span><span class="n">safe_get</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="s">&#39;owner&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span>
                                    <span class="n">col_names</span><span class="o">=</span><span class="n">col_names</span><span class="p">,</span>
                                    <span class="n">col_types</span><span class="o">=</span><span class="n">col_types</span><span class="p">,</span>
                                    <span class="n">col_categories</span><span class="o">=</span><span class="n">col_categories</span><span class="p">,</span>
                                    <span class="n">col_factors</span><span class="o">=</span><span class="n">col_factors</span><span class="p">,</span>
                                    <span class="n">is_mutable</span><span class="o">=</span><span class="n">is_mutable</span><span class="p">,</span>
                                    <span class="n">data_source</span><span class="o">=</span><span class="n">safe_get</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="s">&#39;dataSourceProfile&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
                                    <span class="n">created_time</span><span class="o">=</span><span class="n">res</span><span class="p">[</span><span class="s">&#39;createdTime&#39;</span><span class="p">],</span>
                                    <span class="n">last_refresh_time</span><span class="o">=</span><span class="n">safe_get</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="s">&#39;lastRefreshTime&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span>
                                    <span class="n">last_refresh_user</span><span class="o">=</span><span class="n">safe_get</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="s">&#39;lastRefreshUser&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span>
                                    <span class="n">last_modified_time</span><span class="o">=</span><span class="n">safe_get</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="s">&#39;lastModifiedTime&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span>
                                    <span class="n">last_modified_user</span><span class="o">=</span><span class="n">safe_get</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="s">&#39;lastModifiedUser&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">),</span>
                                    <span class="n">table_name</span><span class="o">=</span><span class="n">res</span><span class="p">[</span><span class="s">&#39;tableName&#39;</span><span class="p">]</span>
                                    <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Could not create a DistributedDataFrame from invalid server response:</span><span class="se">\n</span><span class="s">&#39;</span>
                         <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="o">.</span><span class="n">message</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>


<span class="c">###############################################################################</span>

</div>
<div class="viewcode-block" id="DistributedDataFrame"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame">[docs]</a><span class="k">class</span> <span class="nc">DistributedDataFrame</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A distributed data frame.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cli</span><span class="p">,</span> <span class="n">oid</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">owner</span><span class="p">,</span> <span class="n">col_names</span><span class="p">,</span> <span class="n">col_types</span><span class="p">,</span> <span class="n">col_categories</span><span class="p">,</span> <span class="n">col_factors</span><span class="p">,</span>
                 <span class="n">is_mutable</span><span class="p">,</span> <span class="n">data_source</span><span class="p">,</span> <span class="n">created_time</span><span class="p">,</span> <span class="n">last_refresh_time</span><span class="p">,</span> <span class="n">last_refresh_user</span><span class="p">,</span>
                 <span class="n">last_modified_time</span><span class="p">,</span> <span class="n">last_modified_user</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new DistributedDataFrame. This is not intended to be used by the user.</span>
<span class="sd">        It is used internally to handle responses from server.</span>
<span class="sd">        :param cli: Client object</span>
<span class="sd">        :param oid: unique ID of the DDF</span>
<span class="sd">        :param name:</span>
<span class="sd">        :param owner:</span>
<span class="sd">        :param col_names: a list of column names</span>
<span class="sd">        :param col_types: a list of data type</span>
<span class="sd">        :param col_categories: list of categories</span>
<span class="sd">        :param col_factors: which column is a factor</span>
<span class="sd">        :param is_mutable:</span>
<span class="sd">        :param data_source:</span>
<span class="sd">        :param created_time:</span>
<span class="sd">        :param last_refresh_time:</span>
<span class="sd">        :param last_refresh_user:</span>
<span class="sd">        :param last_modified_time:</span>
<span class="sd">        :param last_modified_user:</span>
<span class="sd">        :param table_name:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span> <span class="o">=</span> <span class="n">cli</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span> <span class="o">=</span> <span class="n">oid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span> <span class="o">=</span> <span class="n">owner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span> <span class="o">=</span> <span class="n">col_names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coltypes</span> <span class="o">=</span> <span class="n">col_types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_colcategories</span> <span class="o">=</span> <span class="n">col_categories</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_colfactors</span> <span class="o">=</span> <span class="n">col_factors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_mutable</span> <span class="o">=</span> <span class="n">is_mutable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_source</span> <span class="o">=</span> <span class="n">data_source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_created_time</span> <span class="o">=</span> <span class="n">created_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_refresh_time</span> <span class="o">=</span> <span class="n">last_refresh_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_refresh_user</span> <span class="o">=</span> <span class="n">last_refresh_user</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_modified_time</span> <span class="o">=</span> <span class="n">last_modified_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_modified_user</span> <span class="o">=</span> <span class="n">last_modified_user</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_table_name</span> <span class="o">=</span> <span class="n">table_name</span>

    <span class="c">###############################################################################################</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> DistributedDataFrame (name=</span><span class="si">%s</span><span class="s">, id=</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> \
               <span class="p">(</span><span class="s">&#39;A mutable&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_mutable</span> <span class="k">else</span> <span class="s">&#39;An immutable&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">u&#39;</span><span class="si">%s</span><span class="s"> DistributedDataFrame (name=</span><span class="si">%s</span><span class="s">, id=</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> \
               <span class="p">(</span><span class="s">u&#39;A mutable&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_mutable</span> <span class="k">else</span> <span class="s">u&#39;An immutable&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> DistributedDataFrame</span><span class="se">\n</span><span class="s">Name: </span><span class="si">%s</span><span class="se">\n</span><span class="s">ID: </span><span class="si">%s</span><span class="se">\n</span><span class="si">%d</span><span class="s"> columns:</span><span class="se">\n</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> \
               <span class="p">(</span><span class="s">&#39;A mutable&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_mutable</span> <span class="k">else</span> <span class="s">&#39;An immutable&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">),</span>
                <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Provide method name lookup and completion</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># TODO: filter out all the invalid names in self._colnames</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="nb">dir</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">subset_expression</span> <span class="kn">import</span> <span class="n">SubsetExpression</span><span class="p">,</span> <span class="n">column_names_to_operands</span><span class="p">,</span> <span class="n">column_indices_to_operands</span>

        <span class="c"># df[&#39;col1&#39;]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">SubsetExpression</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span>
                                        <span class="bp">None</span><span class="p">,</span> <span class="n">column_names_to_operands</span><span class="p">([</span><span class="n">item</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&#39;Column not found: &#39;</span> <span class="o">+</span> <span class="n">item</span><span class="p">)</span>

        <span class="c"># df[[1, 2, 3]], df[[&#39;col1&#39;, col2&#39;]]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">item</span><span class="p">]):</span>
                <span class="c"># list of ints (column indices)</span>
                <span class="k">return</span> <span class="n">SubsetExpression</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span>
                                        <span class="bp">None</span><span class="p">,</span> <span class="n">column_indices_to_operands</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">item</span><span class="p">]):</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">item</span><span class="p">]):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Expect a list of column names&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">SubsetExpression</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span>
                                        <span class="bp">None</span><span class="p">,</span> <span class="n">column_names_to_operands</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&#39;Unsupported mixed keys: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>

        <span class="c"># df[df.col1 &gt; 3, &#39;col2&#39;], df[df.col1 &gt; 3, [&#39;col1&#39;, &#39;col2&#39;]]</span>
        <span class="c"># df[df.col1 &gt; 3, :], df[:, [&#39;col1&#39;, &#39;col2&#39;]]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&#39;Expect a tuple of length 2&#39;</span><span class="p">)</span>

            <span class="n">filter_exp</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">cols_exp</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cols_exp</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cols_exp</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">):</span>
                <span class="n">final_cols</span> <span class="o">=</span> <span class="n">column_names_to_operands</span><span class="p">([</span><span class="n">cols_exp</span><span class="p">])</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cols_exp</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cols_exp</span><span class="p">]):</span>
                    <span class="n">final_cols</span> <span class="o">=</span> <span class="n">column_indices_to_operands</span><span class="p">(</span><span class="n">cols_exp</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cols_exp</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cols_exp</span><span class="p">]):</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Expect a list of column names in the second part of the expression&#39;</span><span class="p">)</span>
                    <span class="n">final_cols</span> <span class="o">=</span> <span class="n">column_names_to_operands</span><span class="p">(</span><span class="n">cols_exp</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&#39;Unsupported mixed columns: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cols_exp</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cols_exp</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
                <span class="n">final_cols</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">*</span><span class="n">cols_exp</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">)))]</span>
                <span class="n">final_cols</span> <span class="o">=</span> <span class="n">column_names_to_operands</span><span class="p">(</span><span class="n">final_cols</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&#39;Unsupported column expression: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cols_exp</span><span class="p">))</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filter_exp</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filter_exp</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">):</span>
                <span class="n">filter_exp</span> <span class="o">=</span> <span class="n">FilterExpressionVisitor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">filter_exp</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filter_exp</span><span class="p">,</span> <span class="n">SubsetExpression</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">SubsetExpression</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span>
                                        <span class="n">filter_exp</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">final_cols</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filter_exp</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">filter_exp</span><span class="o">.</span><span class="n">start</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">filter_exp</span><span class="o">.</span><span class="n">step</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">filter_exp</span><span class="o">.</span><span class="n">stop</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">SubsetExpression</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">final_cols</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&#39;Unsupported slice as the filter expression: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">filter_exp</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&#39;Unsupported filter expression:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">filter_exp</span><span class="p">))</span>

        <span class="c"># df[:], df[1:4]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="n">final_cols</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">*</span><span class="n">item</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">)))]</span>
            <span class="n">final_cols</span> <span class="o">=</span> <span class="n">column_names_to_operands</span><span class="p">(</span><span class="n">final_cols</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">SubsetExpression</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">final_cols</span><span class="p">)</span>

        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&#39;Unsupported index schema: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;After regular attribute access, try looking up the name</span>
<span class="sd">        This allows simpler access to columns for interactive work.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Note: obj.x will always call obj.__getattribute__(&#39;x&#39;) prior to</span>
        <span class="c"># calling obj.__getattr__(&#39;x&#39;).</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">DistributedDataFrame</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__getattribute__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">raise</span>

    <span class="c">###############################################################################################</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">oid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :return: a String containing the name of this DDF,</span>
<span class="sd">        or None if it is not specified.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>

    <span class="nd">@name.setter</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a name for this DDF.</span>
<span class="sd">        This will send a request to server to update the name of this DDF</span>
<span class="sd">        :param value: A string</span>
<span class="sd">        :return: Nothing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">util</span><span class="o">.</span><span class="n">check_type</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s">&#39;value&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;SetDDFName&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;dataContainerId&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span>
                                                  <span class="s">&#39;ddfName&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">owner</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_owner</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">coltypes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_coltypes</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">colfactors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colfactors</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">colcategories</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colcategories</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">colnames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">)</span>

    <span class="nd">@colnames.setter</span>
    <span class="k">def</span> <span class="nf">colnames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">)</span> <span class="ow">or</span> \
                <span class="p">(</span><span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">value</span><span class="p">])):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Expecting a list of strings of length equal to the number of columns&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span> <span class="o">=</span> <span class="n">value</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;SetColumnNames&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span>
                                                  <span class="s">&#39;columnNames&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">})</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_mutable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_mutable</span>

    <span class="nd">@is_mutable.setter</span>
    <span class="k">def</span> <span class="nf">is_mutable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Expect a boolean (True/False) value&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_mutable</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_is_mutable</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;MutableDDF&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span> <span class="s">&#39;isMutable&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_mutable</span><span class="p">})</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">last_refresh_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_refresh_time</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">last_refresh_user</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_refresh_user</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">last_modified_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_modified_time</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">last_modified_user</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_modified_user</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rows</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;NRow&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">})[</span><span class="s">&#39;result&#39;</span><span class="p">][</span><span class="s">&#39;nrow&#39;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cols</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">uri</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;GetURI&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">})[</span><span class="s">&#39;result&#39;</span><span class="p">][</span><span class="s">&#39;str&#39;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">client</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span>

    <span class="c">###########################################################################</span>

<div class="viewcode-block" id="DistributedDataFrame.refresh"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.refresh">[docs]</a>    <span class="k">def</span> <span class="nf">refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Refresh this DDF (on the server side only?)</span>
<span class="sd">        :return: Nothing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;Refresh&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">})</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.unique"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.unique">[docs]</a>    <span class="k">def</span> <span class="nf">unique</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove duplicated rows in a DistributedDataFrame</span>
<span class="sd">        :return: a DistributedDataFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&quot;UniqueRows&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">})[</span><span class="s">&#39;result&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">create_distributed_data_frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.count_unique_values"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.count_unique_values">[docs]</a>    <span class="k">def</span> <span class="nf">count_unique_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_names</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Count number of distinct values for some columns in a DistributedDataFrame</span>
<span class="sd">        :param column_names: a list of column names. Default value is None, meaning the function applies on all columns.</span>
<span class="sd">        :return: a pandas DataFrame containing the unique counts of specified columns</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">column_names</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column_names</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column_names</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">):</span>
                <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">column_names</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">column_names</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;column_names: expected a list of column names&#39;</span><span class="p">)</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">util</span><span class="o">.</span><span class="n">parse_column</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">column_names</span><span class="p">)]</span>

        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;CountUniqueValues&#39;</span><span class="p">,</span>
                                     <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span>
                                      <span class="s">&#39;columnIndices&#39;</span><span class="p">:</span> <span class="n">cols</span><span class="p">})[</span><span class="s">&#39;result&#39;</span><span class="p">]</span>
        <span class="n">df_ret</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;column&#39;</span><span class="p">,</span> <span class="s">&#39;unique_count&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
            <span class="n">df_ret</span> <span class="o">=</span> <span class="n">df_ret</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">&#39;column&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="s">&#39;tuple&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
                                    <span class="s">&#39;unique_count&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s">&#39;tuple&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df_ret</span>
</div>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    NA handling</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DistributedDataFrame.drop_na"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.drop_na">[docs]</a>    <span class="k">def</span> <span class="nf">drop_na</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="s">&#39;row&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s">&#39;any&#39;</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Drop rows/columns with missing values</span>
<span class="sd">        :param margin: &#39;row&#39; or &#39;column&#39;</span>
<span class="sd">        :param how: &#39;all&#39; or &#39;any&#39;, controlling in what condition a row/column is dropped.</span>
<span class="sd">        If how = &#39;any&#39;, a row/column will be dropped if it contains at least one missing value.</span>
<span class="sd">        If how = &#39;all&#39;, a row/column will only be dropped if all of its value are missing.</span>
<span class="sd">        This parameter will be overridden by {@code thresh} parameter if {@code thresh} is set.</span>
<span class="sd">        :param thresh: minimum number of missing values to trigger a drop action.</span>
<span class="sd">        :return: a DistributedDataFrame with rows or columns with missing values being dropped</span>
<span class="sd">        if the current DDF is immutable. Otherwise, the rows or columns are dropped in place.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">margin</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;row&#39;</span><span class="p">,</span> <span class="s">&#39;column&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;margin: expect either &quot;row&quot; or &quot;column&quot;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">how</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;any&#39;</span><span class="p">,</span> <span class="s">&#39;all&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;how: expect either &quot;any&quot; or &quot;all&quot;&#39;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;DropNA&#39;</span><span class="p">,</span>
                                     <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span>
                                      <span class="s">&#39;axis&#39;</span><span class="p">:</span> <span class="n">margin</span><span class="p">,</span> <span class="s">&#39;how&#39;</span><span class="p">:</span> <span class="n">how</span><span class="p">,</span>
                                      <span class="s">&#39;thresh&#39;</span><span class="p">:</span> <span class="n">thresh</span><span class="p">,</span> <span class="s">&#39;columns&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">})[</span><span class="s">&#39;result&#39;</span><span class="p">]</span>
        <span class="n">new_df</span> <span class="o">=</span> <span class="n">create_distributed_data_frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_return_mutable_ddf</span><span class="p">(</span><span class="n">new_df</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.fill_na"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.fill_na">[docs]</a>    <span class="k">def</span> <span class="nf">fill_na</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="il">0L</span><span class="p">,</span>
                <span class="n">agg_func</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">columns_to_values</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fill up missing values in this DistributedDataFrame</span>
<span class="sd">        :param value: value used to fill</span>
<span class="sd">        :param method: None or &#39;bfill&#39; or &#39;ffill&#39;</span>
<span class="sd">        :param limit:</span>
<span class="sd">        :param agg_func: None, &#39;mean&#39; or &#39;median&#39;</span>
<span class="sd">        :param columns_to_values:</span>
<span class="sd">        :param columns:</span>
<span class="sd">        :return: a new DDF if this DDF is immutable, otherwise this DDF with filled values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;bfill&#39;</span><span class="p">,</span> <span class="s">&#39;ffill&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;method: expect &quot;bfill&quot; or &quot;ffill&quot;&#39;</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">agg_func</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">columns_to_values</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">method</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">agg_func</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">columns_to_values</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">elif</span> <span class="n">agg_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">agg_func</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;mean&#39;</span><span class="p">,</span> <span class="s">&#39;median&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;agg_func: expect &quot;mean&quot; or &quot;median&quot;&#39;</span><span class="p">)</span>
            <span class="n">columns_to_values</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">method</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="n">columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_column_list</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="s">&#39;columns: expected a list of column names&#39;</span><span class="p">)</span>

        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;FillNA&#39;</span><span class="p">,</span>
                                     <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span>
                                      <span class="s">&#39;value&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span> <span class="s">&#39;method&#39;</span><span class="p">:</span> <span class="n">method</span><span class="p">,</span>
                                      <span class="s">&#39;limit&#39;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span> <span class="s">&#39;function&#39;</span><span class="p">:</span> <span class="n">agg_func</span><span class="p">,</span>
                                      <span class="s">&#39;columnsToValues&#39;</span><span class="p">:</span> <span class="n">columns_to_values</span><span class="p">,</span>
                                      <span class="s">&#39;columns&#39;</span><span class="p">:</span> <span class="n">columns</span><span class="p">})[</span><span class="s">&#39;result&#39;</span><span class="p">]</span>
        <span class="n">new_df</span> <span class="o">=</span> <span class="n">create_distributed_data_frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_return_mutable_ddf</span><span class="p">(</span><span class="n">new_df</span><span class="p">)</span>
</div>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sampling methods</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DistributedDataFrame.head"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.head">[docs]</a>    <span class="k">def</span> <span class="nf">head</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">raise_on_error</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get first n rows, try to cast the type of the columns in the result DataFrame</span>
<span class="sd">        :param n: number of rows</span>
<span class="sd">        :param raise_on_error: whether or not to raise Exception if</span>
<span class="sd">        there is errors when casting column data types</span>
<span class="sd">        :return: a pandas DataFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;FetchRows&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span>
                                                   <span class="s">&#39;limit&#39;</span><span class="p">:</span> <span class="n">n</span><span class="p">})[</span><span class="s">&#39;result&#39;</span><span class="p">][</span><span class="s">&#39;data&#39;</span><span class="p">]</span>
        <span class="n">df_ret</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
            <span class="n">df_ret</span> <span class="o">=</span> <span class="n">df_ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">([(</span><span class="n">col</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span><span class="p">,</span> <span class="n">col</span>
                                         <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">)]),</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df_ret</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
            <span class="n">df_ret</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_ret</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">to_python_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_coltypes</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">raise_on_error</span><span class="o">=</span><span class="n">raise_on_error</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df_ret</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.copy"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clone a distributed DataFrame</span>
<span class="sd">        :return: a new DistributedDataFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;CopyDDF&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">create_distributed_data_frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.rbind"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.rbind">[docs]</a>    <span class="k">def</span> <span class="nf">rbind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Merge the `other` DDF into this DDF.</span>
<span class="sd">        The name `rbind` of this function is kept for historical reasons.</span>
<span class="sd">        :param other: another DDF</span>
<span class="sd">        :return: the newly merged DDF</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">util</span><span class="o">.</span><span class="n">check_type</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s">&#39;other&#39;</span><span class="p">,</span> <span class="n">DistributedDataFrame</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;MergeDDF&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;dataContainerID1&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span>
                                                  <span class="s">&#39;dataContainerID2&#39;</span><span class="p">:</span> <span class="n">other</span><span class="o">.</span><span class="n">oid</span><span class="p">})[</span><span class="s">&#39;result&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">create_distributed_data_frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.sample"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.sample">[docs]</a>    <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">,</span> <span class="n">raise_on_error</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a sample of the DDF</span>
<span class="sd">        :param size: number of rows</span>
<span class="sd">        :param replace:</span>
<span class="sd">        :param seed:</span>
<span class="sd">        :param raise_on_error: whether or not to raise Exception if</span>
<span class="sd">        there is errors when casting column data types</span>
<span class="sd">        :return: a pandas DataFrame containing the sample</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;SampleDataFrame&#39;</span><span class="p">,</span>
                                     <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span>
                                      <span class="s">&#39;size&#39;</span><span class="p">:</span> <span class="n">size</span><span class="p">,</span>
                                      <span class="s">&#39;replace&#39;</span><span class="p">:</span> <span class="n">replace</span><span class="p">,</span>
                                      <span class="s">&#39;getPercent&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                                      <span class="s">&#39;seed&#39;</span><span class="p">:</span> <span class="n">seed</span><span class="p">})[</span><span class="s">&#39;result&#39;</span><span class="p">][</span><span class="s">&#39;data&#39;</span><span class="p">]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span>
        <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
            <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">to_python_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_coltypes</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="n">raise_on_error</span><span class="o">=</span><span class="n">raise_on_error</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>
</div>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Statistical functions</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DistributedDataFrame.summary"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.summary">[docs]</a>    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get columns&#39; summaries</span>
<span class="sd">        :return: a DistributedDataFrameSummary object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;QuickSummary&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">})[</span><span class="s">&#39;result&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">DistributedDataFrameSummary</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colcategories</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colfactors</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.asummary"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.asummary">[docs]</a>    <span class="k">def</span> <span class="nf">asummary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate advanced summary values</span>
<span class="sd">        :return: raw response from server</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;AdvanceSummary&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">})[</span><span class="s">&#39;result&#39;</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.five_nums"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.five_nums">[docs]</a>    <span class="k">def</span> <span class="nf">five_nums</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get numeric columns&#39; quantile values</span>
<span class="sd">        :return: a pandas DataFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;FiveNumSummary&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">})[</span><span class="s">&#39;result&#39;</span><span class="p">]</span>

        <span class="n">d</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;column&#39;</span><span class="p">,</span> <span class="s">&#39;min&#39;</span><span class="p">,</span> <span class="s">&#39;1st_quantile&#39;</span><span class="p">,</span> <span class="s">&#39;median&#39;</span><span class="p">,</span> <span class="s">&#39;3rd_quantile&#39;</span><span class="p">,</span> <span class="s">&#39;max&#39;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">colidx</span><span class="p">,</span> <span class="n">colname</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">):</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">colidx</span><span class="p">]</span>
            <span class="k">if</span> <span class="s">&#39;min&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s">&#39;column&#39;</span><span class="p">:</span> <span class="n">colname</span><span class="p">,</span>
                    <span class="s">&#39;min&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s">&#39;min&#39;</span><span class="p">],</span>
                    <span class="s">&#39;1st_quantile&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s">&#39;first_quartile&#39;</span><span class="p">],</span>
                    <span class="s">&#39;median&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s">&#39;median&#39;</span><span class="p">],</span>
                    <span class="s">&#39;3rd_quantile&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s">&#39;third_quartile&#39;</span><span class="p">],</span>
                    <span class="s">&#39;max&#39;</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="s">&#39;max&#39;</span><span class="p">]</span>
                <span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s">&#39;column&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.quantile"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.quantile">[docs]</a>    <span class="k">def</span> <span class="nf">quantile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_name</span><span class="p">,</span> <span class="n">prob</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate quantiles of a DistributedDataFrame&#39;s numeric column</span>
<span class="sd">        :param column_name: column name, right</span>
<span class="sd">        :param prob: a list of probabilities, e.g. [0, 1, 0.25]</span>
<span class="sd">        :param b: accuracy</span>
<span class="sd">        :return: a pandas DataFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">column_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">)</span> <span class="ow">or</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_colcategories</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">column_name</span><span class="p">)]</span> <span class="o">!=</span> <span class="s">&#39;numeric&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;column_name: expect the name of a numeric column&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">prob</span><span class="p">])):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;probs: expect a list of probabilities&#39;</span><span class="p">)</span>

        <span class="c"># Because pA does not support quantile on a DDF with more than 2 columns</span>
        <span class="c"># due to the representation of DistributedVector as a one-column DDF</span>
        <span class="c"># We temporarily create a new DDF with one column and invoke VectorQuantiles</span>
        <span class="n">tmp_ddf</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span><span class="o">.</span><span class="n">result</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;VectorQuantiles&#39;</span><span class="p">,</span>
                                     <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="n">tmp_ddf</span><span class="o">.</span><span class="n">oid</span><span class="p">,</span>
                                      <span class="s">&#39;pArray&#39;</span><span class="p">:</span> <span class="n">prob</span><span class="p">,</span> <span class="s">&#39;B&#39;</span><span class="p">:</span> <span class="n">b</span><span class="p">})[</span><span class="s">&#39;result&#39;</span><span class="p">]</span>
        <span class="n">df_ret</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;prob&#39;</span><span class="p">,</span> <span class="s">&#39;value&#39;</span><span class="p">])</span>
        <span class="n">df_ret</span><span class="p">[</span><span class="s">&#39;prob&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;</span><span class="si">%d%%</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">prob</span><span class="p">]</span>
        <span class="n">df_ret</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span>
        <span class="k">return</span> <span class="n">df_ret</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.histogram"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.histogram">[docs]</a>    <span class="k">def</span> <span class="nf">histogram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_name</span><span class="p">,</span> <span class="n">breaks</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute histogram of a DistributedDataFrame&#39;s column with uniform bin-widths</span>
<span class="sd">        :param column_name: column name of x to compute the histogram</span>
<span class="sd">        :param breaks: number of bins.</span>
<span class="sd">        :return: a pandas DataFrame consisting of (x,y) pairs</span>
<span class="sd">        that represents the histogram&#39;s bin range (start) and height.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">column_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;column_name: expect the name of a column&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">breaks</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span> <span class="ow">or</span> <span class="n">breaks</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;breaks: expect a positive integer value&#39;</span><span class="p">)</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;VectorHistogram&#39;</span><span class="p">,</span>
                                     <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span>
                                      <span class="s">&#39;columnName&#39;</span><span class="p">:</span> <span class="n">column_name</span><span class="p">,</span>
                                      <span class="s">&#39;numBins&#39;</span><span class="p">:</span> <span class="n">breaks</span><span class="p">,</span>
                                      <span class="s">&#39;isUniformBins&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">})[</span><span class="s">&#39;result&#39;</span><span class="p">]</span>
        <span class="n">df_ret</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="s">&#39;histogramBins&#39;</span><span class="p">])</span>
        <span class="n">df_ret</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;range&#39;</span><span class="p">,</span> <span class="s">&#39;count&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">df_ret</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.min"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.min">[docs]</a>    <span class="k">def</span> <span class="nf">min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the minimum value of a DistributedDataFrame&#39;s numeric or factored numeric column</span>
<span class="sd">        :param column: the column name or index</span>
<span class="sd">        :return: the minimum value of {@code column_name}.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vector_min_max</span><span class="p">(</span><span class="s">&#39;VectorMin&#39;</span><span class="p">,</span> <span class="n">util</span><span class="o">.</span><span class="n">parse_column_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">,</span> <span class="n">column</span><span class="p">))[</span><span class="s">&#39;min&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.max"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.max">[docs]</a>    <span class="k">def</span> <span class="nf">max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the minimum value of a DistributedDataFrame&#39;s numeric or factored numeric column</span>
<span class="sd">        :param column: the column name or index</span>
<span class="sd">        :return: the minimum value of {@code column_name}.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vector_min_max</span><span class="p">(</span><span class="s">&#39;VectorMax&#39;</span><span class="p">,</span> <span class="n">util</span><span class="o">.</span><span class="n">parse_column_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">,</span> <span class="n">column</span><span class="p">))[</span><span class="s">&#39;max&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.mean"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.mean">[docs]</a>    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute mean of a DistributedDataFrame&#39;s column</span>
<span class="sd">        :param column: the column name or index</span>
<span class="sd">        :return: float, mean of the given column</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vector_stats</span><span class="p">(</span><span class="s">&#39;VectorMean&#39;</span><span class="p">,</span> <span class="n">util</span><span class="o">.</span><span class="n">parse_column_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">,</span> <span class="n">column</span><span class="p">))[</span><span class="s">&#39;mean&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.var"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.var">[docs]</a>    <span class="k">def</span> <span class="nf">var</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute variance of a DistributedDataFrame&#39;s column</span>
<span class="sd">        :param column: the column name or index</span>
<span class="sd">        :return: float, variance of the given column</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vector_stats</span><span class="p">(</span><span class="s">&#39;VectorVariance&#39;</span><span class="p">,</span> <span class="n">util</span><span class="o">.</span><span class="n">parse_column_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">,</span> <span class="n">column</span><span class="p">))[</span><span class="s">&#39;variance&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.sd"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.sd">[docs]</a>    <span class="k">def</span> <span class="nf">sd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute standard deviation of a DistributedDataFrame&#39;s column</span>
<span class="sd">        :param column: the column name or index</span>
<span class="sd">        :return: float, variance of the given column</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_vector_stats</span><span class="p">(</span><span class="s">&#39;VectorVariance&#39;</span><span class="p">,</span> <span class="n">util</span><span class="o">.</span><span class="n">parse_column_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">,</span> <span class="n">column</span><span class="p">))[</span><span class="s">&#39;stddev&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.cov"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.cov">[docs]</a>    <span class="k">def</span> <span class="nf">cov</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xcol</span><span class="p">,</span> <span class="n">ycol</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Covariance of a DistributedDataFrame&#39;s two numeric columns</span>
<span class="sd">        :param xcol: a numeric column</span>
<span class="sd">        :param ycol: a numeric column</span>
<span class="sd">        :return: a float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">xcol</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colcategories</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">xcol</span><span class="p">)]</span> <span class="o">!=</span> <span class="s">&#39;numeric&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;xcol: expect a numeric column name&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ycol</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colcategories</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">ycol</span><span class="p">)]</span> <span class="o">!=</span> <span class="s">&#39;numeric&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;ycol: expect a numeric column name&#39;</span><span class="p">)</span>

        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;VectorCovariance&#39;</span><span class="p">,</span>
                                     <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span>
                                      <span class="s">&#39;xColumn&#39;</span><span class="p">:</span> <span class="n">xcol</span><span class="p">,</span> <span class="s">&#39;yColumn&#39;</span><span class="p">:</span> <span class="n">ycol</span><span class="p">})[</span><span class="s">&#39;result&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s">&#39;covariance&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.cor"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.cor">[docs]</a>    <span class="k">def</span> <span class="nf">cor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xcol</span><span class="p">,</span> <span class="n">ycol</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Correlation coefficient of a DistributedDataFrame&#39;s two numeric columns</span>
<span class="sd">        :param xcol: a numeric column</span>
<span class="sd">        :param ycol: a numeric column</span>
<span class="sd">        :return: a float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">xcol</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colcategories</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">xcol</span><span class="p">)]</span> <span class="o">!=</span> <span class="s">&#39;numeric&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;xcol: expect a numeric column name&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ycol</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colcategories</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">ycol</span><span class="p">)]</span> <span class="o">!=</span> <span class="s">&#39;numeric&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;ycol: expect a numeric column name&#39;</span><span class="p">)</span>

        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;VectorCorrelation&#39;</span><span class="p">,</span>
                                     <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span>
                                      <span class="s">&#39;xColumn&#39;</span><span class="p">:</span> <span class="n">xcol</span><span class="p">,</span> <span class="s">&#39;yColumn&#39;</span><span class="p">:</span> <span class="n">ycol</span><span class="p">})[</span><span class="s">&#39;result&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="s">&#39;correlation&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.sort"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.sort">[docs]</a>    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">descending</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sort a DDF</span>
<span class="sd">        :param column: a column to be sorted, can be the column name or index</span>
<span class="sd">        :param descending: sort on descending order if TRUE, ascending if FALSE</span>
<span class="sd">        :return: sorted DDF</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;SortDDF&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span>
                                                 <span class="s">&#39;column&#39;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">parse_column_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">,</span> <span class="n">column</span><span class="p">),</span>
                                                 <span class="s">&#39;descending&#39;</span><span class="p">:</span> <span class="n">descending</span><span class="p">})[</span><span class="s">&#39;result&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">create_distributed_data_frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.sample2ddf"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.sample2ddf">[docs]</a>    <span class="k">def</span> <span class="nf">sample2ddf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">percent</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">123</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;SampleDataFrame&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span>
                                                         <span class="s">&#39;percent&#39;</span><span class="p">:</span> <span class="n">percent</span><span class="p">,</span>
                                                         <span class="s">&#39;replace&#39;</span><span class="p">:</span> <span class="n">replace</span><span class="p">,</span>
                                                         <span class="s">&#39;getPercent&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                                                         <span class="s">&#39;seed&#39;</span><span class="p">:</span> <span class="n">seed</span><span class="p">})[</span><span class="s">&#39;result&#39;</span><span class="p">]</span>
        <span class="n">adf</span> <span class="o">=</span> <span class="n">create_distributed_data_frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">adf</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.cut"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.cut">[docs]</a>    <span class="k">def</span> <span class="nf">cut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">break_type</span><span class="o">=</span><span class="s">&#39;equalInterval&#39;</span><span class="p">,</span> <span class="n">breaks</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">include_lowest</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">digit_label</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a DistributedDataFrame numeric column to an DistributedFactor one.</span>
<span class="sd">        Return the current DDF if it is mutable, otherwise a new DDF.</span>

<span class="sd">        This function divides the range of a numeric column into intervals and codes the values</span>
<span class="sd">        according to which interval they fall.</span>
<span class="sd">        The leftmost interval corresponds to level one, the next leftmost to level two and so on.</span>
<span class="sd">        :param column: column name or index</span>
<span class="sd">        :param break_type: &#39;custom&#39;, &#39;equalInterval&#39; or &#39;equalFreq&#39;</span>
<span class="sd">            &#39;custom&#39;: custom intervals - users supply an array of break points.</span>
<span class="sd">            &#39;equalInterval&#39;: intervals of equal size.</span>
<span class="sd">            &#39;equalFreq&#39;: intervals of equal number of values.</span>
<span class="sd">        :param breaks: either a numeric vector of two or more unique cut points</span>
<span class="sd">            or a single number (greater than or equal to 2)</span>
<span class="sd">            giving the number of intervals into which column is to be cut.</span>
<span class="sd">        :param include_lowest: logical, indicating if an &#39;x[i]&#39; equal to the lowest</span>
<span class="sd">            (or highest, for right = FALSE) &#39;breaks&#39; value should be included.</span>
<span class="sd">        :param right: logical, indicating if the intervals should be closed</span>
<span class="sd">            on the right (and open on the left) or vice versa.</span>
<span class="sd">        :param digit_label: integer which is used when labels are not given.</span>
<span class="sd">            It determines the number of digits used in formatting the break numbers.</span>
<span class="sd">        :return: A new DistributedDataFrame with the same properties as x,</span>
<span class="sd">            except the &#39;column&#39; which is now of DistributedFactor category.</span>
<span class="sd">            Values which fall outside the range of breaks are coded as NA, as are NaN and NA values.</span>
<span class="sd">            Return the current DDF if it is mutable, otherwise a new DDF</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">column_idx</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">parse_column</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span>
        <span class="n">column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">[</span><span class="n">column_idx</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colcategories</span><span class="p">[</span><span class="n">column_idx</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;numeric&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;column: expect a name or index of a *numeric* column&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">break_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;equalInterval&#39;</span><span class="p">,</span> <span class="s">&#39;equalFrequency&#39;</span><span class="p">,</span> <span class="s">&#39;custom&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;breakType should be &quot;custom&quot;, &quot;equalInterval&quot; or &quot;equalFreq&quot;&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">break_type</span> <span class="o">==</span> <span class="s">&#39;custom&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">breaks</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">breaks</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Please supply at least two cut points for breakType of &quot;custom&quot;&#39;</span><span class="p">)</span>
            <span class="n">breaks</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">breaks</span><span class="p">)))</span>
            <span class="n">nb</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">breaks</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">breaks</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">breaks</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">int</span> <span class="ow">or</span> <span class="n">breaks</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;breaks must be a positive integer for breakTypes &quot;equalInterval&quot; and &quot;equalFreq&quot;&#39;</span><span class="p">)</span>
            <span class="n">nb</span> <span class="o">=</span> <span class="n">breaks</span>
            <span class="n">breaks</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;Binning&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span>
                                                 <span class="s">&#39;col&#39;</span><span class="p">:</span> <span class="n">column</span><span class="p">,</span>
                                                 <span class="s">&#39;binningType&#39;</span><span class="p">:</span> <span class="n">break_type</span><span class="p">,</span>
                                                 <span class="s">&#39;numBins&#39;</span><span class="p">:</span> <span class="n">nb</span><span class="p">,</span>
                                                 <span class="s">&#39;breaks&#39;</span><span class="p">:</span> <span class="n">breaks</span><span class="p">,</span>
                                                 <span class="s">&#39;includeLowest&#39;</span><span class="p">:</span> <span class="n">include_lowest</span><span class="p">,</span>
                                                 <span class="s">&#39;right&#39;</span><span class="p">:</span> <span class="n">right</span><span class="p">,</span>
                                                 <span class="s">&#39;decimalPlaces&#39;</span><span class="p">:</span> <span class="n">digit_label</span><span class="p">})[</span><span class="s">&#39;result&#39;</span><span class="p">]</span>

        <span class="n">new_df</span> <span class="o">=</span> <span class="n">create_distributed_data_frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="p">,</span> <span class="n">ret</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_return_mutable_ddf</span><span class="p">(</span><span class="n">new_df</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.scale"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.scale">[docs]</a>    <span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">how</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scaling and Centering of DistributedDataFrames</span>
<span class="sd">        http://en.wikipedia.org/wiki/Feature_scaling</span>
<span class="sd">        :param how: &#39;rescaling&#39; or &#39;normalization&#39;</span>
<span class="sd">            rescaling: (x-min)/(max-min)</span>
<span class="sd">            normalization: (x-mean)/sd</span>
<span class="sd">        :return: a new DDF</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">how</span> <span class="o">==</span> <span class="s">&#39;rescaling&#39;</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;TransformScaleMinMax&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">})</span>
        <span class="k">elif</span> <span class="n">how</span> <span class="o">==</span> <span class="s">&#39;normalization&#39;</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;TransformScaleStandard&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Supported scaling types: &quot;rescaling&quot; and &quot;normalization&quot;&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">create_distributed_data_frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="p">,</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;result&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.transform"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.transform">[docs]</a>    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;Hive&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        DistributedDataFrame columns transformation</span>
<span class="sd">        Similar to {@code transform}, this function adds columns to a DistributedDataFrame</span>
<span class="sd">        and/or modifies its existing ones.</span>
<span class="sd">        :param method: Hive or R syntax. Currently only Hive is supported in PyClient</span>
<span class="sd">        :param args: Further arguments, mostly the transformation expressions</span>
<span class="sd">        :return: The modified DistributedDataFrame.</span>
<span class="sd">        If the current DDF is mutable, this function returns the current DDF</span>
<span class="sd">        If the current DDF is immutable, this function returns a new DDF</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;hive&#39;</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;TransformHive&#39;</span><span class="p">,</span>
                                         <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span>
                                          <span class="s">&#39;transformExpression&#39;</span><span class="p">:</span>
                                              <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="p">])})[</span><span class="s">&#39;result&#39;</span><span class="p">]</span>
            <span class="n">new_df</span> <span class="o">=</span> <span class="n">create_distributed_data_frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>

            <span class="c"># If a DDF is mutable, the returned id will be the same to the one of the input DDF</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span> <span class="o">==</span> <span class="n">new_df</span><span class="o">.</span><span class="n">oid</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span> <span class="o">=</span> <span class="n">new_df</span><span class="o">.</span><span class="n">colnames</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_coltypes</span> <span class="o">=</span> <span class="n">new_df</span><span class="o">.</span><span class="n">coltypes</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_colcategories</span> <span class="o">=</span> <span class="n">new_df</span><span class="o">.</span><span class="n">colcategories</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_colfactors</span> <span class="o">=</span> <span class="n">new_df</span><span class="o">.</span><span class="n">colfactors</span>
                <span class="k">return</span> <span class="bp">self</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">new_df</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&#39;Unsupported transform method: &#39;</span> <span class="o">+</span> <span class="n">method</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.xtabs"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.xtabs">[docs]</a>    <span class="k">def</span> <span class="nf">xtabs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cross_cols</span><span class="p">,</span> <span class="n">target_cols</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dropna</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cross Tabulation</span>

<span class="sd">        Create a contingency table.</span>
<span class="sd">        :param cross_cols: list of cross-classifying variables (whatever on the right of R&#39;s formula).</span>
<span class="sd">            Interactions are not allowed.</span>
<span class="sd">        :param target_cols: optionally a list of columns (whatever on the left of R&#39;s formula)</span>
<span class="sd">        :param dropna: boolean, default True</span>
<span class="sd">            Do not include columns whose entries are all NaN</span>
<span class="sd">        :return: a pandas DataFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">re</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">cross_cols</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">]]):</span>
            <span class="n">cross_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">cross_cols</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">target_cols</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">]]):</span>
            <span class="n">target_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">target_cols</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_check_column_list</span><span class="p">(</span><span class="n">cross_cols</span><span class="p">,</span> <span class="s">&#39;Expect a list of column names in cross_cols&#39;</span><span class="p">)</span>
        <span class="n">cross_cols_str</span> <span class="o">=</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cross_cols</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">target_cols</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">target_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;count&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_column_list</span><span class="p">(</span><span class="n">target_cols</span><span class="p">,</span> <span class="s">&#39;Expect a list of column names in target_cols&#39;</span><span class="p">)</span>
        <span class="n">target_cols_str</span> <span class="o">=</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">target_cols</span><span class="p">])</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;Xtabs&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span>
                                                <span class="s">&#39;gcols&#39;</span><span class="p">:</span> <span class="n">cross_cols_str</span><span class="p">,</span>
                                                <span class="s">&#39;scols&#39;</span><span class="p">:</span> <span class="n">target_cols_str</span><span class="p">})[</span><span class="s">&#39;result&#39;</span><span class="p">][</span><span class="s">&#39;results&#39;</span><span class="p">]</span>

        <span class="n">df_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">cross_cols</span> <span class="o">+</span> <span class="n">target_cols</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">df_data</span> <span class="o">=</span> <span class="n">df_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">cross_cols</span> <span class="o">+</span> <span class="n">target_cols</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,|</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">entry</span><span class="p">))),</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cross_cols</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">df_data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">cross_cols</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">([</span><span class="n">df_data</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cross_cols</span><span class="p">[:</span><span class="mi">1</span><span class="p">]],</span>
                           <span class="p">[</span><span class="n">df_data</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cross_cols</span><span class="p">[</span><span class="mi">1</span><span class="p">:]],</span>
                           <span class="n">rownames</span><span class="o">=</span><span class="n">cross_cols</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span> <span class="n">colnames</span><span class="o">=</span><span class="n">cross_cols</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
                           <span class="n">values</span><span class="o">=</span><span class="n">df_data</span><span class="p">[</span><span class="n">target_cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                           <span class="n">aggfunc</span><span class="o">=</span><span class="nb">sum</span><span class="p">,</span>
                           <span class="n">dropna</span><span class="o">=</span><span class="n">dropna</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.aggregate"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.aggregate">[docs]</a>    <span class="k">def</span> <span class="nf">aggregate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groupby_cols</span><span class="p">,</span> <span class="n">agg_cols</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get aggregated values for a DistributedDataFrame by specifying group-by columns and aggregation columns</span>
<span class="sd">        :param groupby_cols: rhs, list of column names</span>
<span class="sd">        :param agg_cols: lhs, list of column names</span>
<span class="sd">        :param func: the aggregate function, currently support sum, count, mean, median, variance.</span>
<span class="sd">        :return: a pandas DataFrame consisting of group-by values and corresponding aggregate values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">groupby_cols</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">]]):</span>
            <span class="n">groupby_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">groupby_cols</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">agg_cols</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">]]):</span>
            <span class="n">agg_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">agg_cols</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_check_column_list</span><span class="p">(</span><span class="n">groupby_cols</span><span class="p">,</span> <span class="s">&#39;Expect a list of column names in groupby_cols&#39;</span><span class="p">)</span>
        <span class="n">groupby_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">groupby_cols</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_column_list</span><span class="p">(</span><span class="n">agg_cols</span><span class="p">,</span> <span class="s">&#39;Expect a list of column names in agg_cols&#39;</span><span class="p">)</span>
        <span class="n">agg_cols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">agg_cols</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">x</span> <span class="ow">in</span> <span class="n">groupby_cols</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">agg_cols</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Columns in agg_cols must not be in groupby_cols&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span> <span class="ow">or</span> <span class="n">func</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;sum&#39;</span><span class="p">,</span> <span class="s">&#39;count&#39;</span><span class="p">,</span> <span class="s">&#39;mean&#39;</span><span class="p">,</span> <span class="s">&#39;median&#39;</span><span class="p">,</span> <span class="s">&#39;variance&#39;</span><span class="p">,</span> <span class="s">&#39;var&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Unsupported function &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">func</span><span class="p">))</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">func</span> <span class="o">==</span> <span class="s">&#39;var&#39;</span><span class="p">:</span>
            <span class="n">func</span> <span class="o">=</span> <span class="s">&#39;variance&#39;</span>

        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;Aggregate&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span>
                                                   <span class="s">&#39;colnames&#39;</span><span class="p">:</span> <span class="n">agg_cols</span><span class="p">,</span>
                                                   <span class="s">&#39;groupBy&#39;</span><span class="p">:</span> <span class="n">groupby_cols</span><span class="p">,</span>
                                                   <span class="s">&#39;func&#39;</span><span class="p">:</span> <span class="n">func</span><span class="p">})[</span><span class="s">&#39;result&#39;</span><span class="p">][</span><span class="s">&#39;results&#39;</span><span class="p">]</span>
        <span class="n">df_ret</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">groupby_cols</span> <span class="o">+</span> <span class="n">agg_cols</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">groupby_cols</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)))</span>
            <span class="n">d</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">agg_cols</span><span class="p">,</span> <span class="n">v</span><span class="p">)))</span>
            <span class="n">df_ret</span> <span class="o">=</span> <span class="n">df_ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df_ret</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.groupby"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.groupby">[docs]</a>    <span class="k">def</span> <span class="nf">groupby</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agg_cols</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute Summary Statistics of a DistributedDataFrame&#39;s Subsets</span>
<span class="sd">        Splits a DistributedDataFrame into subsets, computes summary statistics for each,</span>
<span class="sd">        and returns the result in a convenient form.</span>

<span class="sd">        :param agg_cols: a list of columns to calculate summary statistics, with the aggregation function</span>
<span class="sd">        :param by: a list of grouping columns</span>
<span class="sd">        :return: a new DistributedDataFrame containing only the columns involved.</span>

<span class="sd">        Example: ddf.groupby([&#39;avg(ip_count)&#39;], by=[&#39;application&#39;])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">agg_cols</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">]]):</span>
            <span class="n">agg_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">agg_cols</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">by</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">]]):</span>
            <span class="n">by</span> <span class="o">=</span> <span class="p">[</span><span class="n">by</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">by</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">by</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">by</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Please specify columns to group by. &#39;</span>
                             <span class="s">&#39;If you want to compute aggregation over all rows, then use aggregate()&#39;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;GroupBy&#39;</span><span class="p">,</span>
                                     <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span>
                                      <span class="s">&#39;selectFunctions&#39;</span><span class="p">:</span> <span class="n">agg_cols</span><span class="p">,</span>
                                      <span class="s">&#39;groupedColumns&#39;</span><span class="p">:</span> <span class="n">by</span><span class="p">})[</span><span class="s">&#39;result&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">create_distributed_data_frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.pivot"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.pivot">[docs]</a>    <span class="k">def</span> <span class="nf">pivot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">pivot_column</span><span class="p">,</span> <span class="n">value_column</span><span class="p">,</span> <span class="n">agg_func</span><span class="o">=</span><span class="s">&#39;sum&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a long-format DistributedDataFrame to wide-format one</span>
<span class="sd">        :param keys: key columns for pivot</span>
<span class="sd">        :param pivot_column: pivot column</span>
<span class="sd">        :param value_column: value column</span>
<span class="sd">        :param agg_func:</span>
<span class="sd">        :return: a DistributedDataFrame</span>
<span class="sd">        :example:</span>
<span class="sd">        &gt; ddf</span>
<span class="sd">            subject variable value</span>
<span class="sd">         1    John     time  1.00</span>
<span class="sd">         2    Mary     time  1.00</span>
<span class="sd">         3    John      age 33.00</span>
<span class="sd">         4    Mary      age 33.00</span>
<span class="sd">         5    John   weight 90.00</span>
<span class="sd">         6    Mary   weight    NA</span>
<span class="sd">         7    John   height  1.87</span>
<span class="sd">         8    Mary   height  1.54</span>
<span class="sd">        &gt; pivotedDDF = ddf.pivot([&quot;subject&quot;], &quot;variable&quot;, &quot;value&quot;, &quot;sum&quot;)</span>
<span class="sd">        &gt; pivotedDDF</span>
<span class="sd">               subject value_variable_age value_variable_height value_variable_time value_variable_weight</span>
<span class="sd">         1        John                 33                  1.87                   1                    90</span>
<span class="sd">         2        Mary                 33                  1.54                   1                    NA</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">]]):</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">keys</span><span class="p">]</span>
        <span class="n">util</span><span class="o">.</span><span class="n">check_type</span><span class="p">(</span><span class="n">pivot_column</span><span class="p">,</span> <span class="s">&#39;pivot_column&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">)</span>
        <span class="n">util</span><span class="o">.</span><span class="n">check_type</span><span class="p">(</span><span class="n">value_column</span><span class="p">,</span> <span class="s">&#39;value_column&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">)</span>

        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;Pivot&#39;</span><span class="p">,</span>
                                     <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span> <span class="s">&#39;keys&#39;</span><span class="p">:</span> <span class="n">keys</span><span class="p">,</span>
                                      <span class="s">&#39;pivotCol&#39;</span><span class="p">:</span> <span class="n">pivot_column</span><span class="p">,</span> <span class="s">&#39;valueCol&#39;</span><span class="p">:</span> <span class="n">value_column</span><span class="p">,</span>
                                      <span class="s">&#39;aggregationFunc&#39;</span><span class="p">:</span> <span class="n">agg_func</span><span class="p">})[</span><span class="s">&#39;result&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">create_distributed_data_frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.melt"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.melt">[docs]</a>    <span class="k">def</span> <span class="nf">melt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">value_columns</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a wide format DistributedDataFrame to a long format one</span>
<span class="sd">        :param keys: key columns for pivot</span>
<span class="sd">        :param value_columns: value columns</span>
<span class="sd">        :return: a DistributedDataFrame</span>
<span class="sd">        :example:</span>
<span class="sd">        &gt; ddf</span>
<span class="sd">           id x y z</span>
<span class="sd">         1  1 A B C</span>
<span class="sd">         2  2 D E F</span>
<span class="sd">         3  3 G H I</span>
<span class="sd">        &gt; metledDDF = ddf.melt(&quot;id&quot;, [&quot;x&quot;, &quot;y&quot;, &quot;z&quot;])</span>
<span class="sd">        &gt; meltedDDF</span>
<span class="sd">           id variable value</span>
<span class="sd">         1  1        x     A</span>
<span class="sd">         2  1        y     B</span>
<span class="sd">         3  1        z     C</span>
<span class="sd">         4  2        x     D</span>
<span class="sd">         5  2        y     E</span>
<span class="sd">         6  2        z     F</span>
<span class="sd">         7  3        x     G</span>
<span class="sd">         8  3        y     H</span>
<span class="sd">         9  3        z     I</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">]]):</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">keys</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">value_columns</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">]]):</span>
            <span class="n">value_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">value_columns</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_check_column_list</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="s">&#39;keys: expected a list of column names&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_column_list</span><span class="p">(</span><span class="n">value_columns</span><span class="p">,</span> <span class="s">&#39;value_columns: expected a list of column names&#39;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;Melt&#39;</span><span class="p">,</span>
                                     <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span>
                                      <span class="s">&#39;keys&#39;</span><span class="p">:</span> <span class="n">keys</span><span class="p">,</span>
                                      <span class="s">&#39;valueCols&#39;</span><span class="p">:</span> <span class="n">value_columns</span><span class="p">})[</span><span class="s">&#39;result&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">create_distributed_data_frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.persist"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.persist">[docs]</a>    <span class="k">def</span> <span class="nf">persist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;PersistDDF&#39;</span><span class="p">,</span>
                                      <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span> <span class="s">&#39;overwrite&#39;</span><span class="p">:</span> <span class="n">overwrite</span><span class="p">})[</span><span class="s">&#39;result&#39;</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.save_as_table"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.save_as_table">[docs]</a>    <span class="k">def</span> <span class="nf">save_as_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span>
        <span class="n">util</span><span class="o">.</span><span class="n">check_type</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="s">&#39;table_name&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;SaveAsTable&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span> <span class="s">&#39;tableName&#39;</span><span class="p">:</span> <span class="n">table_name</span><span class="p">})[</span><span class="s">&#39;result&#39;</span><span class="p">]</span>
</div>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Type casting</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="DistributedDataFrame.as_type"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.as_type">[docs]</a>    <span class="k">def</span> <span class="nf">as_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">new_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change type of a DistributedDataFrame&#39;s column</span>
<span class="sd">        :param column: name of column to change type</span>
<span class="sd">        :param new_type: new type, currenly support int, float, unicode, str, bool only</span>
<span class="sd">        :return: a DistributedDataFrame with the corresponding column&#39;s type changed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">new_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;new_type: expect int, float, unicode, str, bool&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">column</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;column: expect a proper column name&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">new_type</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">hive_type</span> <span class="o">=</span> <span class="s">&#39;int&#39;</span>
        <span class="k">elif</span> <span class="n">new_type</span> <span class="ow">is</span> <span class="nb">float</span><span class="p">:</span>
            <span class="n">hive_type</span> <span class="o">=</span> <span class="s">&#39;double&#39;</span>
        <span class="k">elif</span> <span class="n">new_type</span> <span class="ow">is</span> <span class="nb">str</span> <span class="ow">or</span> <span class="n">new_type</span> <span class="ow">is</span> <span class="nb">unicode</span><span class="p">:</span>
            <span class="n">hive_type</span> <span class="o">=</span> <span class="s">&#39;string&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hive_type</span> <span class="o">=</span> <span class="s">&#39;boolean&#39;</span>

        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;CastType&#39;</span><span class="p">,</span>
                                     <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span>
                                      <span class="s">&#39;col&#39;</span><span class="p">:</span> <span class="n">column</span><span class="p">,</span> <span class="s">&#39;newType&#39;</span><span class="p">:</span> <span class="n">hive_type</span><span class="p">})[</span><span class="s">&#39;result&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">create_distributed_data_frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.as_int"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.as_int">[docs]</a>    <span class="k">def</span> <span class="nf">as_int</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change type of a DistributedDataFrame&#39;s column to int</span>
<span class="sd">        :param column: name of column to change type</span>
<span class="sd">        :return: a DistributedDataFrame with the corresponding column&#39;s type changed to int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_type</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.as_float"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.as_float">[docs]</a>    <span class="k">def</span> <span class="nf">as_float</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change type of a DistributedDataFrame&#39;s column to float</span>
<span class="sd">        :param column: name of column to change type</span>
<span class="sd">        :return: a DistributedDataFrame with the corresponding column&#39;s type changed to float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_type</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.as_str"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.as_str">[docs]</a>    <span class="k">def</span> <span class="nf">as_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change type of a DistributedDataFrame&#39;s column to str</span>
<span class="sd">        :param column: name of column to change type</span>
<span class="sd">        :return: a DistributedDataFrame with the corresponding column&#39;s type changed to str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_type</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.as_bool"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.as_bool">[docs]</a>    <span class="k">def</span> <span class="nf">as_bool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change type of a DistributedDataFrame&#39;s column to bool</span>
<span class="sd">        :param column: name of column to change type</span>
<span class="sd">        :return: a DistributedDataFrame with the corresponding column&#39;s type changed to bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">as_type</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DistributedDataFrame.as_factor"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrame.as_factor">[docs]</a>    <span class="k">def</span> <span class="nf">as_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert DistributedDataFrame&#39;s columns into factors.</span>
<span class="sd">        The conversion is done in-place. This function returns the DDF itself.</span>
<span class="sd">        :param columns: a list of column names</span>
<span class="sd">        :return: the current DDF</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># get column indices from columns</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">):</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">columns</span><span class="p">]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="s">&#39;GetMultiFactor&#39;</span><span class="p">,</span>
                                     <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span>
                                      <span class="s">&#39;columnIndexs&#39;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">parse_columns</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">,</span> <span class="n">columns</span><span class="p">)})</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colfactors</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_colfactors</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">factor</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="s">&#39;result&#39;</span><span class="p">]:</span>
            <span class="n">col_idx</span> <span class="o">=</span> <span class="n">factor</span><span class="p">[</span><span class="s">&#39;tuple&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_colcategories</span><span class="p">[</span><span class="n">col_idx</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;DistributedFactor&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_colfactors</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">[</span><span class="n">col_idx</span><span class="p">]]</span> <span class="o">=</span> <span class="n">factor</span><span class="p">[</span><span class="s">&#39;tuple&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span>
</div>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Helper methods</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_return_mutable_ddf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_df</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_mutable</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">oid</span> <span class="o">==</span> <span class="n">new_df</span><span class="o">.</span><span class="n">oid</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span> <span class="o">=</span> <span class="n">new_df</span><span class="o">.</span><span class="n">colnames</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_coltypes</span> <span class="o">=</span> <span class="n">new_df</span><span class="o">.</span><span class="n">coltypes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_colcategories</span> <span class="o">=</span> <span class="n">new_df</span><span class="o">.</span><span class="n">colcategories</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_colfactors</span> <span class="o">=</span> <span class="n">new_df</span><span class="o">.</span><span class="n">colfactors</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="n">new_df</span>

    <span class="k">def</span> <span class="nf">_vector_min_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command_name</span><span class="p">,</span> <span class="n">column_name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">column_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;column_name: Expect a column name&#39;</span><span class="p">)</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">column_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coltypes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;int&#39;</span><span class="p">,</span> <span class="s">&#39;tinyint&#39;</span><span class="p">,</span> <span class="s">&#39;smallint&#39;</span><span class="p">,</span> <span class="s">&#39;bigint&#39;</span><span class="p">,</span> <span class="s">&#39;integer&#39;</span><span class="p">,</span> <span class="s">&#39;double&#39;</span><span class="p">,</span> <span class="s">&#39;float&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;column_name: expect a name of a numeric column&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="n">command_name</span><span class="p">,</span>
                                      <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span>
                                       <span class="s">&#39;columnName&#39;</span><span class="p">:</span> <span class="n">column_name</span><span class="p">})[</span><span class="s">&#39;result&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_vector_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command_name</span><span class="p">,</span> <span class="n">column_name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">column_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Invalid column name: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">column_name</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli</span><span class="o">.</span><span class="n">exec_command</span><span class="p">(</span><span class="n">command_name</span><span class="p">,</span>
                                      <span class="p">{</span><span class="s">&#39;dataContainerID&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_oid</span><span class="p">,</span>
                                       <span class="s">&#39;columnName&#39;</span><span class="p">:</span> <span class="n">column_name</span><span class="p">})[</span><span class="s">&#39;result&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_check_column_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">or</span> \
                <span class="p">(</span><span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">unicode</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">])):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_colnames</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

<span class="c">###############################################################################</span>

</div>
<div class="viewcode-block" id="DistributedDataFrameSummary"><a class="viewcode-back" href="../../../adatao.core.html#adatao.core.dataframe.DistributedDataFrameSummary">[docs]</a><span class="k">class</span> <span class="nc">DistributedDataFrameSummary</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Object holding the summary information of a DDF.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_nms</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_col_categories</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_col_factors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_server_response</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">col_names</span><span class="p">,</span> <span class="n">col_categories</span><span class="p">,</span> <span class="n">col_factors</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nms</span> <span class="o">=</span> <span class="n">col_names</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_col_categories</span> <span class="o">=</span> <span class="n">col_categories</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_server_response</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_col_factors</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">col_factors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_construct_stats</span><span class="p">()</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_top_factors</span><span class="p">(</span><span class="n">factors</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">[(</span><span class="n">k</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">factors</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">))):</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">: </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Others: </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">sum</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">v</span><span class="p">[</span><span class="n">n</span><span class="p">:]]))</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">server_response</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a copy of original server&#39;s response</span>
<span class="sd">        :return: a dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_response</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_construct_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">col_idx</span><span class="p">,</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nms</span><span class="p">):</span>
            <span class="c">#temporary fix</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_categories</span><span class="p">[</span><span class="n">col_idx</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;character&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_categories</span><span class="p">[</span><span class="n">col_idx</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;logical&#39;</span><span class="p">:</span>
                <span class="n">ret</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="s">&#39;min   :&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_response</span><span class="p">[</span><span class="s">&#39;min&#39;</span><span class="p">][</span><span class="n">col_idx</span><span class="p">]),</span>
                    <span class="s">&#39;max   :&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_response</span><span class="p">[</span><span class="s">&#39;max&#39;</span><span class="p">][</span><span class="n">col_idx</span><span class="p">]),</span>
                    <span class="s">&#39;mean  :&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_response</span><span class="p">[</span><span class="s">&#39;mean&#39;</span><span class="p">][</span><span class="n">col_idx</span><span class="p">]),</span>
                    <span class="s">&#39;stdev :&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_response</span><span class="p">[</span><span class="s">&#39;stdev&#39;</span><span class="p">][</span><span class="n">col_idx</span><span class="p">]),</span>
                    <span class="s">&#39;var   :&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_response</span><span class="p">[</span><span class="s">&#39;var&#39;</span><span class="p">][</span><span class="n">col_idx</span><span class="p">]),</span>
                    <span class="s">&#39;sum   :&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server_response</span><span class="p">[</span><span class="s">&#39;sum&#39;</span><span class="p">][</span><span class="n">col_idx</span><span class="p">]),</span>
                    <span class="s">&#39;count :</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server_response</span><span class="p">[</span><span class="s">&#39;count&#39;</span><span class="p">][</span><span class="n">col_idx</span><span class="p">],</span>
                    <span class="s">&#39;cNA   :</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server_response</span><span class="p">[</span><span class="s">&#39;cNA&#39;</span><span class="p">][</span><span class="n">col_idx</span><span class="p">]</span>
                    <span class="p">]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_categories</span><span class="p">[</span><span class="n">col_idx</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;DistributedFactor&#39;</span><span class="p">:</span>
                <span class="n">ret</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_factors</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_categories</span><span class="p">[</span><span class="n">col_idx</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;character&#39;</span><span class="p">:</span>
                <span class="n">ret</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;character&#39;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_categories</span> <span class="o">==</span> <span class="s">&#39;logical&#39;</span><span class="p">:</span>
                <span class="n">ret</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;logical&#39;</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">_construct_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">col_idx</span><span class="p">,</span> <span class="n">col_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_nms</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_col_categories</span><span class="p">[</span><span class="n">col_idx</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;DistributedFactor&#39;</span><span class="p">:</span>
                <span class="n">ret</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_top_factors</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_col_factors</span><span class="p">[</span><span class="n">col_name</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_construct_table</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">tabulate</span><span class="p">(</span><span class="n">tb</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s">&#39;keys&#39;</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">PyClient 0.3.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Adatao.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>